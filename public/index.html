<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Force Bits</title><link rel="stylesheet" href="styles/main.css"></head><body><canvas id="canvas"></canvas><div class="slider-container"><input type="range" min="0.25" max="5" value="2" step="0.2"> <button id="4k">4k</button> <button id="8k">8k</button> <button id="16k">16k</button> <button id="32k">32k</button> <button id="64k">64k</button> <button id="128k">128k</button> <button id="256k">256k</button></div><p id="cput">CPU Time:</p><p id="gput">GPU Time:</p><script defer="defer">(()=>{"use strict";var e={361:(e,t,r)=>{r.r(t),r.d(t,{default:()=>n});const n="#version 300 es\nprecision highp float;\nin vec3 oColor;\nout vec4 outColor;\n\nvoid main() {\n    outColor = vec4(oColor, 1.0);\n}"},781:(e,t,r)=>{r.r(t),r.d(t,{default:()=>n});const n="#version 300 es\n\nin vec2 aPos;\nin float aDir;\nin float aProp;\n\nuniform vec2 screenDims;\nuniform float universeSize;\nuniform float speed;\nuniform int electronCount;\n// uniform sampler2D electronTex;\n\nout vec2 oPos;\nout float oDir;\nout float oProp;\nout vec3 oColor;\n\nvec4 toClipSpace(vec2 v) {\n    float x = (v.x / screenDims.x) * 2.0 - 1.0;\n    float y = -( (v.y / screenDims.y) * 2.0 - 1.0 );\n\n   return vec4(x, y, 0.0, 1.0);\n}\n\nvec2 fromAngle(float rads) {\n    return vec2(cos(rads), sin(rads));\n}\n\nvoid main() {\n    int aPropI = int(aProp);\n\n    int checkCollide = (aPropI >> 2) & 1;\n    int type = (aPropI >> 3) & 1;\n\n    if(checkCollide == 0) {\n        oPos = aPos;\n        oDir = aDir;\n        oProp = aProp;\n        oColor = vec3(0.0, 0.0, 0.0);\n        gl_PointSize = 0.0;\n        gl_Position = vec4(-5.0, -5.0, 0.0, 1.0);\n\n        return;\n    }\n\n    if(type == 1) {\n        oColor = vec3(1, 0.2588, 0.2588);\n    } else {\n        oColor = vec3(0.2157, 0.3921, 1);\n    }\n\n    vec2 center = screenDims/2.0;\n    vec2 newPos = aPos;\n    int newProp = aPropI;\n\n    if(distance(aPos, center) > universeSize) {\n        newProp ^= (1 << 0); // Respawn\n\n        oPos = aPos;\n        oDir = aDir;\n        oProp = float(newProp);\n        gl_PointSize = 0.0;\n        gl_Position = vec4(-5.0, -5.0, 0.0, 1.0); // Change this later\n\n        return;\n    }\n\n    // for(int i = 0; i < electronCount; i++) {\n    //     vec2 ePos = texelFetch(electronTex, ivec2(i, 0), 0).xy;\n\n    //     if(distance(aPos, ePos) <= 11.0) {\n    //         newProp |= (i << 4); // Encode electron ID\n    //         newProp ^= (1 << 1); // Collided\n\n    //         break;\n    //     }\n    // }\n\n    vec2 fbVel = fromAngle(aDir);\n\n    newPos = newPos+(fbVel*speed);\n\n    oPos = newPos;\n    oDir = aDir;\n    oProp = float(newProp);\n    \n    gl_PointSize = 2.0;\n    gl_Position = toClipSpace(newPos);\n}"},545:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return o(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(6),c=r(147),u=i(r(37)),l=s(r(938)),f=document.querySelector('input[type="range"]'),d=document.getElementById("cput"),h=document.getElementById("gput"),_=document.querySelector("canvas"),m=a.SimManager.init(_,!0),A=m.gl;console.log("gl: ",m.gl),console.log("sm.canvas: ",m.canvas),console.log("canvas: ",_);let E,p,P,b=0,R=0,g=0,y=0,v=[];function w(e){v=[];const t=[],r=[],n=[];for(let o=0;o<e;o++){const e=c.Vec2.random(2*l.default.radius,_.width-2*l.default.radius,2*l.default.radius,_.height-2*l.default.radius),o=Math.random()>.5?"ERB":"PRB",i=new l.default(e.x,e.y,c.Vec2.fromAngle(Math.random()*(2*Math.PI)),o);v.push(i),t.push(i.pos.x,i.pos.y),r.push(i.vel.toAngle());let s=4;s|=("ERB"===o?0:1)<<3,n.push(s)}E=new Float32Array(t),p=new Float32Array(r),P=new Float32Array(n),u.start(A,E,p,P)}!function e(){requestAnimationFrame(e);const t=performance.now();if(v.length>0){A.viewport(0,0,_.width,_.height),A.clearColor(0,0,0,0),A.clear(A.COLOR_BUFFER_BIT);const e=performance.now()-t;b++,R+=e,b>=10&&(d.innerText=`CPU Time: ${(R/10).toFixed(2)}ms`,b=0,R=0),u.draw(+f.value,0)}const r=performance.now()-t;g++,y+=r,g>=10&&(h.innerText=`GPU Time: ${(y/10).toFixed(2)}ms`,g=0,y=0)}(),document.getElementById("4k").onclick=()=>w(4e3),document.getElementById("8k").onclick=()=>w(8e3),document.getElementById("16k").onclick=()=>w(16e3),document.getElementById("32k").onclick=()=>w(32e3),document.getElementById("64k").onclick=()=>w(64e3),document.getElementById("128k").onclick=()=>w(128e3),document.getElementById("256k").onclick=()=>w(256e3),window.sbits=e=>{w(+e)}},938:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(r(906));class i extends o.default{constructor(e,t,r,n){super(i.radius,e,t,r.normalize().mul(1)),this.color=[0,0,0],this.visible=!0,this.fillStyle="",this.polarity=n,this.color="ERB"===n?[.2157,.3921,1]:[1,.2588,.2588],this.fillStyle=`rgb(${255*this.color[0]}, ${255*this.color[1]}, ${255*this.color[2]})`}switchPolarity(){"ERB"===this.polarity?(this.polarity="PRB",this.color=[1,.2588,.2588]):(this.polarity="ERB",this.color=[.2157,.3921,1]),this.fillStyle=`rgb(${255*this.color[0]}, ${255*this.color[1]}, ${255*this.color[2]})`}}t.default=i,i.radius=6},906:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=r(147);t.default=class{constructor(e,t,r,o=new n.Vec2){this.pos=new n.Vec2(t,r),this.vel=o}}},6:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SimManager=void 0;const n=r(293);class o{constructor(e,t){this.physicsInterval=10,this.resizeListeners=[],this.canvas=e,t?this.gl=e.getContext("webgl2"):this.ctx=e.getContext("2d"),e.addEventListener("contextmenu",(e=>{e.preventDefault()})),window.addEventListener("resize",(()=>{this.resize(),this.resizeListeners.forEach((e=>e()))})),this.userInput=new n.UserInput(e),this.resize()}resize(){const{innerWidth:e,innerHeight:t}=window;this.canvas.width=e,this.canvas.height=t}static init(e,t){return o._instance||(o._instance=new o(e,t)),o._instance}static instance(){return o._instance}}t.SimManager=o},293:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UserInput=void 0;const n=r(147);t.UserInput=class{constructor(e){this.mousePos=new n.Vec2,this.lmbDown=!1,this.rmbDown=!1,this.downListeners=[],this.upListeners=[],this.scrollListeners=[],e.addEventListener("wheel",(e=>{for(const t of this.scrollListeners)t(e.deltaY/Math.abs(e.deltaY))})),e.addEventListener("mousemove",(e=>{this.mousePos=new n.Vec2(e.offsetX,e.offsetY)})),e.addEventListener("mousedown",(e=>{switch(e.button){case 0:this.lmbDown=!0;break;case 2:this.rmbDown=!0}for(const t of this.downListeners)t(e)})),e.addEventListener("mouseup",(e=>{for(const t of this.upListeners)t(e);switch(e.button){case 0:this.lmbDown=!1;break;case 2:this.rmbDown=!1}})),e.addEventListener("mouseout",(e=>{this.lmbDown=!1,this.rmbDown=!1}))}}},124:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PolygonGL=t.setAttributes=t.bufferDataAndSetAttribute=t.setBuffer=t.createProgram=t.createShader=void 0;const n=r(722);t.createShader=(e,t,r)=>{const n=e.createShader(t);return n?(e.shaderSource(n,r),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)?n:"Failed to compile shader!"):"Failed to create shader!"},t.createProgram=(e,t,r,n)=>{const o=e.createProgram();if(!o)return"Failed to create program!";if(e.attachShader(o,t),e.attachShader(o,r),n&&e.transformFeedbackVaryings(o,n,e.SEPARATE_ATTRIBS),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS)){const t=e.getProgramInfoLog(o);return e.deleteProgram(o),t}return o},t.setBuffer=(e,t,r,n)=>{e.bindBuffer(e.ARRAY_BUFFER,t),e.bufferData(e.ARRAY_BUFFER,r,n),e.bindBuffer(e.ARRAY_BUFFER,null)},t.bufferDataAndSetAttribute=(e,t,r,n,o,i,s,a=!1)=>{e.bindBuffer(e.ARRAY_BUFFER,t),e.bufferData(e.ARRAY_BUFFER,n,s),e.enableVertexAttribArray(r),a?e.vertexAttribIPointer(r,i,o,0,0):e.vertexAttribPointer(r,i,o,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,null)},t.setAttributes=(e,t,r,n,o)=>{e.bindBuffer(e.ARRAY_BUFFER,t),e.enableVertexAttribArray(r),e.vertexAttribPointer(r,o,n,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,null)},t.PolygonGL=class{constructor(e,t){this.verts=[],this.radius=e,this.nVerts=t;const r=2*Math.PI/t;let o=(0,n.degreesToRadians)(0);this.verts.push(0,0,Math.cos(o)*e,Math.sin(o)*e,Math.cos(o+r)*e,Math.sin(o+r)*e),o+=r;for(let n=1;n<t+1;n++)this.verts.push(0,0,this.verts.at(-2),this.verts.at(-1),Math.cos(o)*e,Math.sin(o)*e),o+=r}}},722:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.randFloat=t.randInt=t.degreesToRadians=t.radiansToDegrees=void 0,t.radiansToDegrees=e=>180*e/Math.PI,t.degreesToRadians=e=>e*Math.PI/180,t.randInt=(e,t)=>Math.floor(Math.random()*(t-e+1)+e),t.randFloat=(e,t)=>Math.random()*(t-e)+e},147:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Color=t.Vec2=void 0;const n=r(722);class o{constructor(e=0,t=0){this._x=e,this._y=t}add(e){return new o(this._x+e.x,this._y+e.y)}sub(e){return new o(this._x-e.x,this._y-e.y)}mul(e){return new o(this._x*e,this._y*e)}div(e){return new o(this._x/e.x,this._y/e.y)}normalize(){const e=Math.sqrt(Math.pow(this._x,2)+Math.pow(this._y,2));return new o(this._x/e,this._y/e)}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}distance(e){const t=this._x-e.x,r=this._y-e.y;return Math.sqrt(Math.pow(t,2)+Math.pow(r,2))}direction(e){return this.sub(e).normalize()}rotate(e){return new o(this._x*Math.cos(e)-this._y*Math.sin(e),this._x*Math.sin(e)+this._y*Math.cos(e))}angleBetween(e){return Math.atan2(e.y*this._x-e.x*this._y,e.x*this._x+e.y*this._y)}toAngle(){return Math.atan2(this._y,this._x)}copy(){return new o(this._x,this._y)}surfaceNorm(){return new o(-this._y,this._x)}static random(e,t,r,i){return new o((0,n.randFloat)(e,t),(0,n.randFloat)(r,i))}static fromAngle(e){return new o(Math.cos(e),Math.sin(e))}get mag(){return Math.sqrt(Math.pow(this._x,2)+Math.pow(this._y,2))}get x(){return this._x}set x(e){this._x=e}get y(){return this._y}set y(e){this._y=e}}t.Vec2=o,t.Color=class{constructor(e=0,t=0,r=0){this.h=e,this.s=t,this.l=r}}},37:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.draw=t.setfbBuffers=t.setElectronTex=t.start=void 0;const o=r(124),i=n(r(781)),s=n(r(361));let a,c,u,l,f,d,h,_,m,A,E,p,P,b,R,g,y,v,w,T,B,D,F,M,x=0,S=0;t.start=(e,t,r,n)=>{a=e,x=n.length,a.enableVertexAttribArray(0);const S=(0,o.createShader)(a,a.VERTEX_SHADER,i.default),I=(0,o.createShader)(a,a.FRAGMENT_SHADER,s.default);if("string"==typeof S)throw S;if("string"==typeof I)throw I;if(c=(0,o.createProgram)(a,S,I,["oPos","oDir","oProp"]),"string"==typeof c)throw c;d=a.getUniformLocation(c,"screenDims"),h=a.getUniformLocation(c,"universeSize"),_=a.getUniformLocation(c,"speed"),m=a.getUniformLocation(c,"electronCount"),A=a.getUniformLocation(c,"electronTex"),u=a.getAttribLocation(c,"aPos"),l=a.getAttribLocation(c,"aDir"),f=a.getAttribLocation(c,"aProp"),E=a.createBuffer(),p=a.createBuffer(),P=a.createBuffer(),b=a.createBuffer(),R=a.createBuffer(),g=a.createBuffer(),(0,o.bufferDataAndSetAttribute)(a,E,u,t,a.FLOAT,2,a.DYNAMIC_READ),(0,o.bufferDataAndSetAttribute)(a,p,l,r,a.FLOAT,1,a.DYNAMIC_READ),(0,o.bufferDataAndSetAttribute)(a,P,f,n,a.FLOAT,1,a.DYNAMIC_READ),(0,o.setBuffer)(a,b,t,a.DYNAMIC_COPY),(0,o.setBuffer)(a,R,r,a.DYNAMIC_COPY),(0,o.setBuffer)(a,g,n,a.DYNAMIC_COPY),F=a.createTexture(),a.activeTexture(a.TEXTURE0+0),M=a.createTransformFeedback(),y=t,v=r,w=n,T=t,B=r,D=n},t.setElectronTex=e=>{a.bindTexture(a.TEXTURE_2D,F),a.texImage2D(a.TEXTURE_2D,0,a.RG32F,e.length/2,0,0,a.RG,a.FLOAT,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.bindTexture(a.TEXTURE_2D,null)},t.setfbBuffers=(e,t,r)=>{},t.draw=(e,t)=>{if(!a||!c)throw"Cannot draw before starting!";a.useProgram(c),a.uniform2f(d,a.canvas.width,a.canvas.height),a.uniform1f(h,500),a.uniform1f(_,e),a.uniform1i(m,t),a.uniform1i(A,0),a.bindTransformFeedback(a.TRANSFORM_FEEDBACK,M),a.bindBufferBase(a.TRANSFORM_FEEDBACK_BUFFER,0,b),a.bindBufferBase(a.TRANSFORM_FEEDBACK_BUFFER,1,R),a.bindBufferBase(a.TRANSFORM_FEEDBACK_BUFFER,2,g),(0,o.setBuffer)(a,E,T,a.DYNAMIC_READ),(0,o.setBuffer)(a,p,B,a.DYNAMIC_READ),(0,o.setBuffer)(a,P,D,a.DYNAMIC_READ),a.beginTransformFeedback(a.POINTS),a.drawArrays(a.POINTS,0,x),a.endTransformFeedback(),a.bindTransformFeedback(a.TRANSFORM_FEEDBACK,null);const r=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);a.flush();const n=new Promise((e=>{!function t(){if(!r)throw new Error("Sync is not defined!!!");switch(a.clientWaitSync(r,0,0)){case a.TIMEOUT_EXPIRED:return setTimeout(t);case a.WAIT_FAILED:throw new Error("Failed to wait for sync!!!");default:a.deleteSync(r),a.bindBuffer(a.ARRAY_BUFFER,b),a.getBufferSubData(a.ARRAY_BUFFER,0,T),a.bindBuffer(a.ARRAY_BUFFER,R),a.getBufferSubData(a.ARRAY_BUFFER,0,B),a.bindBuffer(a.ARRAY_BUFFER,g),a.getBufferSubData(a.ARRAY_BUFFER,0,D),a.bindBuffer(a.ARRAY_BUFFER,null),e()}}()}));return S=+!S,n}}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n].call(i.exports,i,i.exports,r),i.exports}r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r(545)})();</script></body></html>